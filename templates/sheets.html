{% extends "base.html" %}
{% block static_css %}{% endblock %}
{% load cache humanize sefaria_tags%}
{% load static %}
{% load i18n %}

{% block title %}{% if title %}{{ title|striptags|strip_html_entities }} | {% trans "Sefaria" %}{% else %}{% trans "Start a New Sheet - Sefaria Source Sheet Builder" %}{% endif %}{% endblock %}

{% block description %}{% if sheet.owner %}{% trans "A source sheet created with Sefaria's Source Sheet Builder." %}{% else %}{% trans "Create your own source sheet with Sefaria's Source Sheet Builder." %}{% endif %}{% endblock %}
{% block soc_description %}{% if sheet.owner %}{% trans "A source sheet created with Sefaria's Source Sheet Builder." %}{% else %}{% trans "Create your own source sheet with Sefaria's Source Sheet Builder." %}{% endif %}{% endblock %}

{% block head %}
<link rel="stylesheet" type="text/css" href="{% static 'css/tooltipster.css' %}"/>
<meta name="robots" content="noindex, nofollow">
{% if EMBED %}
<link rel="canonical" href="{{ canonical_url }}">
{% endif %}
{% endblock %}

{% block content %}
<!-- CSS placed here so it has precedence over other sheets in base.html -->
<link rel="stylesheet" href="{% static 'css/sheets.css' %}">
<link rel="stylesheet" href="{% static 'css/sheets-print.css' %}" media="print"/>
<div id="sheetsContent" data-interface-lang="{{ request.interfaceLang }}">

    <div class="sheetsEditNavTop">
        <div class="sheetsMenuBar" role="menu">
            <div class="sheetsMenuBarInner">
                <div class="sheetsMenuBarCommands">
                    <div class="sheetsMenuBarItem" id="fileMenu">
                        <span class="menuHeader" aria-haspopup="true" role="menuitem" tabindex="0">{% trans "File" %}</span>
                        <div class="optionsMenu" aria-hidden="true" aria-label="submenu">
                            {% if not new_sheet %}
                            {% if user.email %}
                            <div class="optionItem" id="copySheet" role="menuitem" tabindex="0">
                                <img src="{% static 'img/copy.png' %}" alt="Copy Sheet Icon">
                                <span class="optionItemText">
                                    <span>{% trans "Copy Sheet" %}</span>
                                </span>
                            </div>
                            {% endif %}
                            {% if user.email %}
                            {% comment %} <div class="optionItem" id="exportToDrive" role="menuitem" tabindex="0">
                                <i class="fa fa-google"></i>
                                <span class="optionItemText">
                                    <span>{% trans "Export to Google Drive" %}</span>
                                </span>
                            </div> {% endcomment %}
                            {% endif %}
                            <div class="optionItem" id="embedSheet" role="menuitem" tabindex="0">
                                <img src="{% static 'img/embed.png' %}" alt="Embed Sheet Icon">
                                <span class="optionItemText">
                                    <span>{% trans "Embed Sheet" %}</span>
                                </span>

                            </div>
                            {% if is_owner %}
                            <div class="optionItem" id="deleteSheet" role="menuitem" tabindex="0">
                                <img src="{% static 'img/delete.png' %}" alt="Delete Sheet Icon">
                                <span class="optionItemText">
                                    <span>{% trans "Delete Sheet" %}</span>
                                </span>

                            </div>
                            {% endif %}

                            {% if user.email %}
                            <div class="line"></div>
                            <div class="optionItem" id="editTags" role="menuitem" tabindex="0">
                                <img src="{% static 'img/edittags.png' %}" alt="Edit Sheet Tags Icon">
                                <span class="optionItemText">
                                    <span>{% trans "Tags" %}</span>
                                </span>

                            </div>
                            {% endif %}
                            {% if is_owner %}
                            {% if not sheet.assigner_id %}

                            <div class="optionGroup">
                                <div class="optionTitle" id="assignmentsModalTrigger">
                                    <img src="{% static 'img/assignment.png' %}" alt="Assignment Icon">
                                    <span class="optionItemText">
                                        <span>{% trans "Assignments" %}</span>
                                    </span>
                                </div>
                            </div>
                            {% endif %}
                            {% endif %}

                            <div class="line"></div>

                            {% endif %}

                            <div class="optionItem" id="print" role="menuitem" tabindex="0">
                                <img src="{% static 'img/print.png' %}" alt="Print Icon">
                                <span class="optionItemText">
                                <span>{% trans "Print" %}</span>
                            </span>
                            </div>
                            {% if not new_sheet %}
                            <div class="optionItem" id="visualize" role="menuitem" tabindex="0">
                                <i class="fa fa-picture-o"></i>
                                <span class="optionItemText">
                                <a href="/sheets/visual/{{sheet.id}}">
                                    <span>{% trans "Visualize" %}</span>
                                </a>
                            </span>
                            </div>
                            <div class="optionItem" id="highlightToggle" role="menuitem" tabindex="0">
                                <i class="fa fa-pencil"></i>
                                <span class="optionItemText">
                                <span id="highlightToggleActivate">
                                    <span>{% trans "Highlight Mode" %}</span>
                                </span>
                                <span id="highlightToggleDeactivate">
                                    <span>{% trans "Exit Highlight Mode" %}</span>
                                </span>
                            </span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="sheetsMenuBarItem" id="formatMenu">
                        <span class="menuHeader" aria-haspopup="true" role="menuitem" tabindex="0">{% trans "Format" %}</span>
                        <div class="optionsMenu" aria-hidden="true" aria-label="submenu">
                            <div class="optionItem" id="numbered" role="menuitem" tabindex="0">
                                <i class="fa fa-check hidden"></i>
                                <span class="optionItemText">
                                <span>{% trans "Number Sources" %}</span>
                            </span>
                            </div>
                            <div class="optionItem" id="boxed" role="menuitem" tabindex="0">
                                <i class="fa fa-check hidden"></i>
                                <span class="optionItemText">
                                <span>{% trans "Box Sources" %}</span>
                            </span>
                            </div>
                            <!-- <div class="optionItem" id="bsd" role="menuitem" tabindex="0">
                                <i class="fa fa-check hidden"></i>
                                <span class="optionItemText"><span class="int-bi">בס"ד</span></span>
                            </div> -->
                            <div class="line"></div>
                            {% if can_edit or can_add %}

                            <div class="optionItem" id="resetText" role="menuitem" tabindex="0">
                                <img src="{% static 'img/reset text.png' %}" alt="Reset Source Text Icon">
                                <span class="optionItemText">
                                <span>{% trans "Reset Source Text" %}</span>
                            </span>
                            </div>

                            <div class="optionItem" id="splitSourceToSegment" role="menuitem" tabindex="0">
                                <i class="fa fa-file-o hidden"></i>
                                <span class="optionItemText">
                                <span class="{{ language_font_class }}">{% trans "Auto-Segment Text" %}</span>
                            </span>
                            </div>


                            <div class="optionItem" id="removeNikkudot" role="menuitem" tabindex="0">
                                <i class="fa fa-file-o hidden"></i>
                                <span class="optionItemText">
                                <span class="{{ language_font_class }}">{% trans "Remove Vowel Points" %}</span>
                            </span>
                            </div>

                            <div class="optionItem" id="addSourceTitle" role="menuitem" tabindex="0">
                                <i class="fa fa-pencil"></i>
                                <span class="optionItemText">
                                <span class="{{ language_font_class }}">{% trans "Add Source Title" %}</span>
                            </span>
                            </div>
                            {% endif %}
                            <div class="line"></div>
                            <div id="sheetLayoutLanguageMenuItems">
                                <div class="optionGroup" id="languageToggleGroup">
                                    <div class="optionTitle menuHeader" aria-haspopup="true" role="menuitem"
                                         tabindex="0">
                                        <i class="fa fa-file-o hidden"></i>
                                        <span class="optionItemText">
                                        <span>{% trans "Sheet Language" %}</span>
                                    </span>
                                        <i class="optionItemCaret fa fa-caret"></i>
                                    </div>
                                    <div class="subMenu languageToggleOption">
                                        <div class="english optionItem" role="menuitem" tabindex="0">
                                            <i class="fa fa-check hidden"></i>
                                            <span class="optionItemText">
                                            <span>{% trans "English" %}</span>
                                        </span>
                                        </div>
                                        <div class="hebrew optionItem" role="menuitem" tabindex="0">
                                            <i class="fa fa-check hidden"></i>
                                            <span class="optionItemText">
                                            <span class="{{ language_font_class }}">{% trans "Tibetan" %}</span>
                                        </span>
                                        </div>
                                        <div class="bilingual optionItem" role="menuitem" tabindex="0">
                                            <i class="fa fa-check hidden"></i>
                                            <span class="optionItemText">
                                            <span>{% trans "Bilingual" %}</span>
                                        </span>
                                        </div>
                                    </div>
                                </div>


                                <div class="optionGroup disabled" id="layoutToggleGroup">
                                    <div class="optionTitle menuHeader" aria-haspopup="true" role="menuitem"
                                         tabindex="0"><i class="fa fa-file-o hidden"></i>
                                        <span class="optionItemText">
                                        <span>{% trans "Sheet Layout" %}</span>
                                    </span>
                                        <i class="optionItemCaret fa fa-caret"></i>
                                    </div>
                                    <div class="subMenu layoutToggleOption">
                                        <div class="stacked optionItem" role="menuitem" tabindex="0">
                                            <i class="fa fa-check hidden"></i>
                                            <span class="optionItemText">
                                            <span>{% trans "Stacked" %}</span>
                                        </span>
                                        </div>
                                        <div class="sideBySide optionItem" role="menuitem" tabindex="0">
                                            <i class="fa fa-check hidden"></i>
                                            <span class="optionItemText">
                                            <span>{% trans "Side-by-Side" %}</span>
                                        </span>
                                        </div>
                                    </div>
                                </div>


                                <div class="optionGroup disabled" id="sideBySideToggleGroup">
                                    <div class="optionTitle menuHeader" aria-haspopup="true" role="menuitem"
                                         tabindex="0"><i class="fa fa-file-o hidden"></i>
                                        <span class="optionItemText">
                                        <span>{% trans "Side-by-Side Layout" %}</span>
                                    </span>
                                        <i class="optionItemCaret fa fa-caret"></i>
                                    </div>
                                    <div class="subMenu sideBySideToggleOption">
                                        <div class="heLeft optionItem" role="menuitem" tabindex="0">
                                            <i class="fa fa-check hidden"></i>
                                            <span class="optionItemText">
                                            <span>{% trans "Tibetan Left" %}</span>
                                        </span>
                                        </div>
                                        <div class="heRight optionItem" role="menuitem" tabindex="0">
                                            <i class="fa fa-check hidden"></i>
                                            <span class="optionItemText">
                                            <span>{% trans "Tibetan Right" %}</span>
                                        </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="sourceLayoutLanguageMenuItems">
                                <div class="optionGroup">
                                    <div class="optionTitle menuHeader" aria-haspopup="true" role="menuitem"
                                         tabindex="0"><i class="fa fa-file-o hidden"></i>
                                        <span class="optionItemText">
                                        <span>{% trans "Source Language" %}</span>
                                    </span>
                                        <i class="optionItemCaret fa fa-caret"></i>
                                    </div>
                                    <div class="subMenu languageToggleOption">
                                        <div class="english">
                                            <i class="fa fa-check hidden"></i>
                                            <span class="optionItemText">
                                            <span>{% trans "English" %}</span>
                                        </span>
                                        </div>
                                        <div class="hebrew">
                                            <i class="fa fa-check hidden"></i>
                                            <span class="optionItemText">
                                            <span>{% trans "Hebrew" %}</span>
                                        </span>
                                        </div>
                                        <div class="bilingual">
                                            <i class="fa fa-check hidden"></i>
                                            <span class="optionItemText">
                                            <span>{% trans "Bilingual" %}</span>
                                        </span>
                                        </div>
                                    </div>
                                </div>


                                <div class="optionGroup disabled" id="layoutToggleGroup">
                                    <div class="optionTitle menuHeader" aria-haspopup="true" role="menuitem"
                                         tabindex="0"><i class="fa fa-file-o hidden"></i>
                                        <span class="optionItemText">
                                        <span>{% trans "Source Layout" %}</span>
                                    </span>
                                        <i class="optionItemCaret fa fa-caret"></i>
                                    </div>
                                    <div class="subMenu layoutToggleOption">
                                        <div class="stacked">
                                            <i class="fa fa-check hidden"></i>
                                            <span class="optionItemText">
                                            <span>{% trans "Stacked" %}</span>
                                        </span>
                                        </div>
                                        <div class="sideBySide">
                                            <i class="fa fa-check hidden"></i>
                                            <span class="optionItemText">
                                            <span>{% trans "Side-by-Side" %}</span>
                                        </span>
                                        </div>
                                    </div>
                                </div>


                                <div class="optionGroup disabled" id="sideBySideToggleGroup">
                                    <div class="optionTitle menuHeader" aria-haspopup="true" role="menuitem"
                                         tabindex="0"><i class="fa fa-file-o hidden"></i>
                                        <span class="optionItemText">
                                        <span>{% trans "Side-by-Side Layout" %}</span>
                                    </span>
                                        <i class="optionItemCaret fa fa-caret"></i>
                                    </div>
                                    <div class="subMenu sideBySideToggleOption">
                                        <div class="heLeft">
                                            <i class="fa fa-check hidden"></i>
                                            <span class="optionItemText">
                                            <span>{% trans "Tibetan Left" %}</span>
                                        </span>
                                        </div>
                                        <div class="heRight">
                                            <i class="fa fa-check hidden"></i>
                                            <span class="optionItemText">
                                            <span>{% trans "Tibetan Right" %}</span>
                                        </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="optionGroup" id="resetSourceTogglesToSheetGroup">
                                    <div class="optionTitle">
                                        <i class="fa fa-file-o hidden"></i>
                                        <span class="optionItemText">
                                        <span>{% trans "Reset to Sheet Default" %}</span>
                                    </span>
                                    </div>
                                </div>

                            </div>


                        </div>

                    </div>
                    {% if can_edit or can_add %}
                    <div class="sheetsMenuBarItem" id="insertMenu">
                        <span class="menuHeader" aria-haspopup="true" role="menuitem" tabindex="0">{% trans "Insert" %}</span>
                        <div class="optionsMenu" aria-hidden="true" aria-label="submenu">
                            <div class="optionItem" id="addSourceMenu" role="menuitem" tabindex="0">
                                <img src="{% static 'img/source.png' %}" alt="Add Source Icon">
                                <span class="optionItemText">
                                <span>{% trans "Source" %}</span>
                            </span>
                            </div>
                            <div class="optionItem" id="addCustomMenu" role="menuitem" tabindex="0">
                                <img src="{% static 'img/custom text.png' %}" alt="Add outside text icon">
                                <span class="optionItemText">
                                <span>{% trans "Text" %}</span>
                            </span>
                            </div>
                            <div class="optionItem" id="addCommentMenu" role="menuitem" tabindex="0">
                                <img src="{% static 'img/comment.png' %}" alt="Add Comment Icon">
                                <span class="optionItemText">
                                <span>{% trans "Comment" %}</span>
                            </span>
                            </div>
                            <div class="optionItem" id="addMediaMenu" role="menuitem" tabindex="0">
                                <img src="{% static 'img/media.png' %}" alt="Add Media Icon">
                                <span class="optionItemText">
                                <span>{% trans "Media" %}</span>
                            </span>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    <div class="sheetsMenuBarItem" id="highlightMenu">
                        <span class="int-en menuHeader" aria-haspopup="true" role="menuitem" tabindex="0">{% trans "Highlight Tools" %}</span>
                        <span class="int-he menuHeader" aria-haspopup="true" role="menuitem" tabindex="0">{% trans "Highlight Tools" %}</span>
                        <div class="optionsMenu" aria-hidden="true" aria-label="submenu">
                            <div class="optionItem segmentedContinuousToggle" data-mode="continuous">
                            <span class="optionItemText">
                                <span class="continuousActive" role="menuitem" tabindex="0">
                                    <span class="{{ language_font_class }}">{% trans "Paragraph View" %}</span>
                                </span>
                                <span class="segmentedActive" role="menuitem" tabindex="0">
                                    <span class="{{ language_font_class }}">{% trans "Line-by-line View" %}</span>
                                </span>
                            </span>
                            </div>
                            {% if can_edit %}
                            <div class='optionItem resetHighlighter'>
                            <span class="optionItemText">
                                <spanclass="{{ language_font_class }}">{% trans "Reset" %}</span>
                            </span>
                            </div>
                            {% endif %}
                            <div class="optionGroup">
                                <div class="optionTitle menuHeader" aria-haspopup="true" role="menuitem" tabindex="0">
                                <span class="optionItemText"><span class="{{ language_font_class }}">{% trans "Filter" %}</span>
                                    <i class="optionItemCaret fa fa-caret"></i>
                                </div>
                                <div class="subMenu">
                                    <div class='highlighterFilterTags'>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="sheetsMenuBarItem" id="lastSavedMenu">
                    <span id="lastSaved">
                    {% if sheet.dateModified %}
                        {% if can_edit or can_add %}
                            <span class="lastSavedStamp">
                                <span class="{{ language_font_class }}>{% trans "Last Saved" %} {{sheet.dateModified|format_date_by_language}}</span>
                            </span>
                            <span class="lastSavedConfirmed">
                                <span class="{{ language_font_class }}">{% trans "All changes saved in Pecha" %}</span>
                            </span>
                            <span class="saving">
                                <span class="{{ language_font_class }}">{% trans "Saving..." %}</span>
                            </span>
                            <span class="pending">
                                <span class="{{ language_font_class }}">{% trans "Changes Pending..." %}</span>
                            </span>

                        {% endif %}
                    {% endif %}
                    </span>
                    </div>
                    <div class="sheetsMenuBarItem" id="higlightModeMenu">
                    <span id="highlightModeDisplay">
                        <span class="{{ language_font_class }}">{% trans "Highlight Mode is On" %}</span>
                    </span>
                    </div>
                </div>
                <div class="sheetsMenuBarButtons">

                    {% if new_sheet %}
                    <a id="save" class="button" data-mode="editing" role="button" tabIndex="0">
                        <i class="fa fa-floppy-o"></i>
                        <span id="doSave">
                        <span>{% trans "Save" %}</span>
                    </span>
                        <span id="inSave">
                        <span>{% trans "Saving..." %}</span>
                    </span>
                    </a>
                    {% elif is_owner %}
                    <a id="share" class="button" role="button" tabIndex="0">
                        <img src="{% static 'img/share.png' %}" alt="Share Icon">
                        <span>{% trans "Share" %}</span>
                    </a>
                    <a id="onlineMode" href="/sheets/{{sheet.id}}" class="button" role="button" tabIndex="0">
                        <span>{% trans "View in Library" %}</span>
                    </a>
                    {% else %}
                    <a id="onlineMode" href="/sheets/{{sheet.id}}" class="button" role="button" tabIndex="0">
                        <span>{% trans "View in Library" %}</span>
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="sheetsEditorControls">
            <div id="ckeTopMenu"></div>
        </div>
    </div>

    <div id="link"></div>
    <div id="error"></div>
    <div id="controls">
        <div>
        </div>
    </div>

    <div id="sheet" class="
    {% if request.interfaceLang == 'english' %}
        {{ sheet_class|default:'bilingual' }}
    {% else %}
        {{ sheet_class|default:'hebrew' }}
    {% endif %}
" role="main">
        {% if not user.email %}
        <div id="fileControls">
            <div id="fileControlMsg">
            <span class="{{ language_font_class }}">
                {% trans "Like this?" %} <a href="/login?next=/sheets/new">{% trans "Login" %}</a>{ % trans "or" %} <a
                    href="/register?next=/sheets/new">{% trans "create an account" %}</a> {% trans "to build your own source sheet." %}
            </span>
            </div>
        </div>

        {% endif %}

        <div id="bsdHeader">{% trans "Header Title" %}</div>
        <div id="sheetHeader" {% if not displayed_collection %}style="display:none" {% endif %}>
            {% if displayed_collection and displayed_collection.headerUrl %}
            <a href="/collections/{{ displayed_collection.slug }}">
                <img id="collectionHeader" src="{{ displayed_collection.headerUrl }}"
                     alt="Logo for {{ displayed_collection.name }}"/>
            </a>
            {% else %}
            <a href="#"><img id="collectionHeader"/></a>
            {% endif %}
        </div>
        <div id="title" role="heading" aria-level="1">
            {% autoescape off %}
            {% with title_t=title|default:_("Loading...") %}
            {{ title_t }}
            {% endwith %}
            {% endautoescape %}
        </div>
        {% if sheet.attribution %}
        <div id="author">
            {% autoescape off %}
            {{ sheet.attribution }}
            {% endautoescape %}
        </div>
        {% elif assigner_id %}
        <div id="author">
            {% if author %}
            {% blocktrans with owner=sheet.owner|user_link %}
            Assignment Completed by {{ owner }}
            {% endblocktrans %}
            {% endif %}
        </div>
        {% elif sheet.assigner_id %}
        <div id="author">
            {% if author %}
            {% blocktrans with owner=sheet.owner|user_link %}
            Assignment Completed by {{ owner }}
            {% endblocktrans %}
            {% endif %}
        </div>
        {% elif author %}
        <div id="author">
            {% blocktrans with owner=sheet.owner|user_link %}
            Source Sheet by {{ owner }}
            {% endblocktrans %}
        </div>
        {% endif %}

        {% if not new_sheet %}

        <details id="sheetMetadata">
            <summary>
                <span>{% trans "More info" %}</span>
            </summary>
            <div class="metadataOpenDetails">
                <div>
                {% if can_edit %}<span
                        class="editButton">{% trans "Edit" %}</span>{% endif %}</span>
                    <span class="{{ language_font_class }}>{% trans "Created" %} <span class="date">{{ sheet.dateCreated|format_date_by_language }}</span> · <span
                            class="views">{% if sheet.views == 1%}{% trans "View" %} {% else %}{{ sheet.views }}
                {% endif %}{% trans "Views" %}</span>{% if can_edit %}<span></span>{% endif %}</span>
                </div>
                {% if sheet.via %}
                <div id="via">
                    <span class="{{ language_font_class }}">{% trans "Based on" %} <a
                        href="/sheets/{{ sheet.via }}">{% trans "a sheet" %}</a>{% trans "by" %} {{ sheet.viaOwner|user_link }}
                    </span>
                </div>

                {% elif assigner_id %}
                <div id="assignmentAttribution">
                    <span>{% trans "Assigned by" %}</span>
                    {{ assigner_id|user_link }}
                </div>

                {% elif sheet.assigner_id %}
                <div id="assignmentAttribution">
                    <span class="{{ language_font_class }}">{% trans "Assigned by" %}</span>
                    {{ sheet.assigner_id|user_link }}
                </div>

                {% endif %}

                <div id="sheetSummary">{{ sheet.summary|linebreaks }}</div>

                <div id="sheetTags">
                    {% for topic in sheet.topics %}
                    <a class="button" role="button" href="/topics/{{ topic.slug }}">
                        {% if request.interfaceLang == 'english' %}
                        {% if topic.en %}
                        {{ topic.en }}
                        {% else %}
                        {{ topic.he }}
                        {% endif %}
                        {% elif request.interfaceLang == 'hebrew' %}
                        {% if topic.he %}
                        {{ topic.he }}
                        {% else %}
                        {{ topic.en }}
                        {% endif %}
                        {% endif %}
                    </a>
                    {% endfor %}


                </div>
            </div>


        </details>
        {% endif %}

        <ol id="sources">
            {% include "sheet.html" with sources=sheet.sources %}
        </ol>
        {% if can_edit or can_add %}
        <div id="addInterface">
            <div class="buttonBar">
                <div class="addInterfaceButton" id="sourceButton" tabindex="0" role="button"><img
                        src="{% static 'img/source.png' %}" alt="Add Source Icon">
                    <span>{% trans "Source" %}</span>
                </div><!--
         -->
                <div class="addInterfaceButton" id="connectionButton" tabindex="0" role="button">
                    <img src="{% static 'img/connection.png' %}" alt="Add Connections Icon">
                    <span>{% trans "Connection" %}</span>
                </div><!--
         -->
                <div class="addInterfaceButton" id="customTextButton" tabindex="0" role="button">
                    <img src="{% static 'img/custom text.png' %}" alt="Add Outside Text Icon">
                    <span>{% trans "Text" %}</span>
                </div><!--
         -->
                <div class="addInterfaceButton" id="mediaButton" tabindex="0" role="button">
                    <img src="{% static 'img/media.png' %}" alt="Add Media Icon">
                    <span>{% trans "Media" %}</span>
                </div><!--
         -->
                <div class="addInterfaceButton" id="commentButton" tabindex="0" role="button">
                    <img src="{% static 'img/comment.png' %}" alt="Add Comment Icon">
                    <span>{% trans "Comment" %}</span>
                </div>
            </div>
            <div class="contentDiv">
                <div id="addsourceDiv">
                    <div id="inlineAddDialogTitle" class="inlineAddDesc">
                        <span>{% trans "Select a text" %}</span>
                    </div>
                    <div class="blockContainer">
                        {% comment %} <input id="inlineAdd" class="inlineAddTextInput"
                               placeholder="{% trans " Search for a Text or Commentator" %}"/> {% endcomment %}
                        <div class="buttonContainer">
                            {% comment %} <div id="inlineAddBrowseBox" class="inlineAddSourceByttons">
                                <div id="inlineAddSourceOK" class='button disabled' role="button" tabIndex="0">
                                    <span>{% trans "Add Source" %}</span>
                                </div>
                            </div> {% endcomment %}
                            {% comment %} <div class="inlineAddOr">
                                <span>{% trans "or" %}</span>
                            </div> {% endcomment %}
                            <div id="inlineAddBrowseBox" class="inlineAddSourceByttons">
                                <div id="inlineAddBrowse" class='button' role="button" tabIndex="0">
                                    <span>{% trans "Browse Sources" %}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div id="addconnectionDiv">
                    <div class="inlineAddDesc">
                        <span class="{{ language_font_class }}">{% trans "Select connected texts" %}</span>
                    </div>
                    <div id="connectionsToAdd"></div>
                    <div class="button" role="button" tabIndex="0">
                        <span class="{{ language_font_class }}">{% trans "Add to Sheet" %}</span>
                    </div>
                </div>
                <div id="addcustomTextDiv">
                    <div class="inlineAddDesc">
                    <span class="{{ language_font_class }}">{% trans "Write or paste text" %}</span>
                    </div>
                    <div id="customTextLanguageToggle" class="toggle">
                    <span id="englishCustomText" class="toggleOption">
                        <img src="{% static 'img/english.png' %}" alt="English Language Toggle">
                    </span>
                        <span id="bilingualCustomText" class="toggleOption active">
                        <img src="{% static 'img/bilingual.png' %}" alt="Bilingual Language Toggle">
                    </span>
                        <span id="hebrewCustomText" class="toggleOption">
                        <img src="{% static 'img/tibetan.png' %}" alt="Tibetan Language Toggle">
                    </span>
                    </div>
                    <div id="customTextContainer" class="flexContainer">
                        <div class="contentToAdd en customTextEditables" tabindex="0">{% trans "english" %}</div>
                        <div class="contentToAdd he customTextEditables" tabindex="0">{% trans "tibetan" %}</div>
                    </div>
                    <div class="button" role="button" tabIndex="0">
                        <span>{% trans "Add to Sheet" %}</span>
                    </div>
                </div>
                <div id="addmediaDiv">
                    <div class="inlineAddDesc">
                        <span>{% trans "Add Image, Youtube Video, SoundCloud link, or MP3" %}</span>

                    </div>
                    <div class="blockContainer">
                        <input id="inlineAddMediaInput" class="inlineAddTextInput"
                               placeholder="{% trans 'Paste URL' %}"/>
                        <div class="buttonContainer">
                            <div class="inlineAddSourceByttons">
                                <div class="button" role="button" tabIndex="0">
                                    <span>{% trans "Add to Sheet" %}</span>
                                </div>
                            </div>
                            <div class="inlineAddOr">
                                <span>{% trans "or" %}</span>
                            </div>
                            <div class="inlineAddSourceByttons">
                                <label for="addmediaFileSelector" class="button" role="button" tabIndex="0">
                                    <i class="fa fa-upload" aria-hidden="true"></i>
                                    <span>{% trans "Upload an Image" %}</span>
                                </label>
                                <input id="addmediaFileSelector" type="file" style="display:none">
                            </div>
                        </div>
                    </div>
                </div>
                <div id="addcommentDiv">
                    <div class="inlineAddDesc">
                        <span>{% trans "Comment on this section" %}</span>
                    </div>
                    <div class="contentToAdd" tabindex="0" data-gramm="false"><br></div>
                    <div class="button" role="button" tabIndex="0">
                        <span>{% trans "Add to Sheet" %}</span>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <div id="sheetLoading" style="display:none">
            <span>{% trans "Loading..." %}</span>
        </div>

        {% if new_sheet and not hide_video %}
        <div id="empty" class="well">

            <div class="fa fa-times remove"></div>
            <iframe width="560" height="315" src="https://www.youtube.com/embed/gp_uI8obQoI" frameborder="0"
                    allowfullscreen></iframe>

            <h3>
                <span>{% trans "Watch a 2 minute intro video or " %}<a class="empty_readmore">{% trans "read more" %}</a>.</span>
            </h3>
            <div id="howItWorks">
                <h1>
                    <span>{% trans "Source Sheet Builder: How it Works" %}</span>

                </h1>
                <ul>
                    <li>
                <span class="int-en">
                    <b>{% trans "Add Sources" %}</b>{% trans "by typing a citation like:" %}
			        <div id="cite"><i>Genesis 4:5-8</i>, <i>Mishnah Peah 2:6</i>, <i>Berakhot 2a:4-7</i>, <i>Bereishit Rabbah 1:4</i>.</div>
                </span>
                <span class="int-he">
                    <b>{% trans "Add Sources" %} </b> {% trans "by typing a citation like:" %}
			        <div id="cite"><i>Mishnah Peah 2:6</i>, <i>Berakhot 2a:4-7</i>, <i>Bereishit Rabbah 1:4</i>.</div>
                </span>
                    </li>
                    <li>
                        <span><b>{% trans "Reorder Sources" %}</b>{% trans "by dragging and dropping." %}</span>
                    </li>
                    <li>
                        <span><b>{% trans "Print" %}</b>{% trans "your sheets to paper or PDF, or just" %} <b>{% trans "Share" %}</b>{% trans " the link." %}</span>
                    </li>
                    <li>
                        <span><b>{% trans "More Options" %}</b>{% trans "are available in the icons that appear when you hover over a source." %}</span>
                    </li>
                </ul>
            </div>
            {% if not user.email %}
            <center id="loginWarning">
                <span class="{{ language_font_class }}">{% trans "Take a spin! But you'll need to " %}<a href="/login?next=/sheets/new">{% trans "login" %}</a> {% trans "or" %} <a
                    href="/register?next=/sheets/new">{% trans "register" %}</a> {% trans "to save your work." %}
                </span>
                
            </center>
            {% endif %}
        </div>
        {% endif %}

        <div id="printFooter">
            <img src="{% static 'img/pecha-icon.png' %}">
            <div style="padding: 8px;">
                {% trans "Made with the Sefaria Source Sheet Builder" %}
                <br/>
                www.pecha.org/sheets
            </div>
        </div>

        <div class='highlighterTools'>
            <div class='highlighterTagWindow'>
                <span class="close-button"></span>
                <div class='tagSelector'>
                    <div class='tagSelectorTitle'>
                        <span>{% trans "Add Highlight" %}</span>
                    </div>
                    <div class='sheetHighlighterTags'></div>
                    <div class='createNewHighlighterTag'>
                        <div class='colorSwatch active' style='background-color: #bd9eb6'></div>
                        <div class='colorSwatch' style='background-color: #afcab8'></div>
                        <div class='colorSwatch' style='background-color: #e5dabd'></div>
                        <div class='colorSwatch' style='background-color: #bd9796'></div>
                        <div class='colorSwatch' style='background-color: #a4b7de'></div>
                        <div class='colorSwatch' style='background-color: #e8dde5'></div>
                        <div class='colorSwatch' style='background-color: #d2ddc9'></div>
                        <div class='tagName' contenteditable='true'>{%trans "Create New" %}</div>
                    </div>
                    <div class='save button'>
                        <span>{% trans "Save" %}</span>
                    </div>
                </div>
            </div>
        </div>

        <div id='inlineTextPreview'></div>

    </div>

    {% if author %}
    <div id="bottomAuthor">
        <span>{% trans "Source Sheet created on Pecha by " %}</span>
        {{ sheet.owner|user_link }}
        {% if sheet.via %}
        <div id="bottomVia">
            <span>{% trans "Based on " %}<a href="/sheets/{{ sheet.via }}">{% trans "a sheet" %}</a>{% trans "by" %}{{ sheet.viaOwner|user_link }}</span>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <div id="belowSheet"></div>


    <div id="assignmentsModal" class="modal s2Modal">
        <span class="close-button"></span>
        <div class="title">
            <span>{% trans "Assignments" %}</span>
        </div>
        <div class="content" id="assignmentDirections">
            <span>{% trans "Assignments allow you to create a template that your students can fill out on their own." %}</span>
        </div>
        <input id="assignmentURLLink" value="{{ request.META.HTTP_HOST }}/sheets/new?assignment={{sheet.id}}"/>
        <div class='button' id="makeSheetAssignableButton">
            <span class="{{ language_font_class }}">{% trans "Assign this Sheet" %}</span>
        </div>
        <div class='button' id="StopCollectingAssignmentsButton">
            <span class="{{ language_font_class }}">{% trans "Stop Collecting Assignments" %}</span>
        </div>
        <br/>
        <div id="assignedSheets">
            <div class="line"></div>

            <div class="title">
                <span class="{{ language_font_class }}">{% trans "Saved Assignments" %}</span>
            </div>
            {% for assignment_sheet in assignments_from_sheet %}
            <a href="./{{ assignment_sheet.id }}?editor=1" target="_blank">
                <div class="button white">{{ assignment_sheet.owner|user_name }}</div>
            </a>

            {% empty %}
            <em>
                <span class="{{ language_font_class }}">{% trans "Your student's saved assignments will be viewable here." %}</span>
            </em>
            {% endfor %}
        </div>

    </div>

    <div id="shareWithOthers" class="modal s2Modal">
        <div class="content">
            <textarea id="sheetSummaryInput"
                      placeholder='{%trans "Write a summary to help others understand your sheet..."%}'>{{sheet.summary}}</textarea>
        </div>

        <div class="line"></div>

        <div class="content">
            <input id="addTag" placeholder='{%trans "Add Tags..."%}'/>
            <ul id="tags"></ul>
            <div id="suggestedTags"></div>
        </div>

        <div class="line"></div>


        <div class="content sideLabeled">
            <label class="labelforOnOffSwitch">
                <span>{% trans "List on Pecha" %}</span>
            </label>
            <div>
                <div class="onoffswitch">
                    <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="sheetPublicToggle">
                    <label class="onoffswitch-label" for="sheetPublicToggle">
                        <span class="onoffswitch-inner"></span>
                        <span class="onoffswitch-switch"></span>
                    </label>
                </div>
            </div>
        </div>

        {% if sheet_collections %}
        <div class="content sideLabeled" id="sourceSheetGroupOptions">
            <label for="sourceSheetGroupSelect">
                <span class="{{ language_font_class }}">{% trans "Display Collection" %}</span>
            </label>

            <div>
                <select id="sourceSheetGroupSelect">
                    <option value="">
                        {% trans 'None' %}
                    </option>

                    {% for collection in sheet_collections %}
                    <option
                            value="{{ collection.slug }}"
                            data-name="{{ collection.name }}"
                            data-image="{{ collection.headerUrl|default:'' }}">
                        {{ collection.name }}
                    </option>
                    {% endfor %}
                </select>
                <div id="collectionsMessage">
                    <span class="{{ language_font_class }}">{% trans "To manage the collections this sheet appears in, visit your profile." %}</span>
                </div>
            </div>
        </div>
        {% endif %}


        <div class="content sideLabeled">
            <label for="shareURL">
                <span>{% trans "Share a link" %}</span>
            </label>
            <div>
                <input id="shareURL" value="{{ request.META.HTTP_HOST }}/sheets/{{sheet.id}}" readonly="readonly"/>
            </div>
        </div>

        <div class="line"></div>

        <div class="content">
            <label for="sourceSheetShareSelect">
                <span>{% trans "Anyone with access can" %}</span>
            </label>
            <div class="custom-select">
                <select id="sourceSheetShareSelect">
                    <option value="view">
                        {% trans "View" %}
                    </option>
                    <option value="add">
                        {% trans "Add" %}
                    </option>
                    <option value="edit">
                        {% trans "Edit" %}
                    </option>
                </select>
            </div>
            <div class="ok button">{% trans "Save" %}</div>
        </div>

    </div>

    <div id="addToSheetModal" class="modal s2Modal">
        <div class="header">
            {% blocktrans %}
            Add <span class="sourceName"></span> to a Source Sheet
            {% endblocktrans %}
        </div>
        <ul id="sheetList">
        </ul>
        <div class="actions">
            <div class="button ok">
                <span class="{{ language_font_class }}">{% trans "Add" %}</span>
            </div>
            <div class="button white cancel">
                <span class="{{ language_font_class }}">{% trans "Cancel" %}</span>
            </div>
        </div>
    </div>

    <div id="embedSheetModal" class="gradient modal s2Modal">
        <span class="close-button"></span>
        <div class="title">
            <span class="{{ language_font_class }}">{% trans "Embed Sheet" %}</span>
        </div>
        <div class="content center">
            <span class="{{ language_font_class }}">{% trans "Copy and paste the embed code below. Adjust the values of width and height to best fit your design." %}</span>
        </div>
        <textarea><iframe src="https://{{ request.get_host }}{{ request.get_full_path }}?embed=1" width="600px" height="600px"></iframe></textarea>
    </div>

    <div id="addParashaToSheetModal" class="modal s2Modal">
        <div class="header">
            <span class="{{ language_font_class }}">{% trans "Add a Parasha to a Source Sheet" %}</span>
        </div>
        <div class="actions">
            <div class="button white cancel">
                <span class="{{ language_font_class }}">{% trans "Cancel" %}</span>
            </div>
        </div>
    </div>

    <div id="overlay"></div>

    <div id="overrideLayoutModal" class="modal s2Modal">
        <div class="header">{% trans "Change this source's layout" %}</div>

        <span id="biLayoutToggleSource" class="toggle"><span id="hebLeftSource" class="toggleOption"><img
                src="{% static 'img/backs.png' %}"></span><span id="hebRightSource" class="toggleOption"><img
                src="{% static 'img/faces.png' %}"></span></span>

        <span id="sheetLayoutToggleSource" class="toggle"><span id="sideBySideSource" class="toggleOption"><img
                src="{% static 'img/sideBySide.png' %}"></span><span id="stackedSource" class="toggleOption"><img
                src="{% static 'img/stacked.png' %}"></span></span>

        <span id="languageToggleSource" class="toggle"><span id="englishSource" class="toggleOption"><img
                src="{% static 'img/english.png' %}"></span><span id="bilingualSource" class="toggleOption"><img
                src="{% static 'img/bilingual.png' %}"></span><span id="hebrewSource" class="toggleOption"><img
                src="{% static 'img/tibetan.png' %}"></span></span>
        <br/>

        <div class="button ok">{% trans "OK" %}</div>
        <h6 id="resetToDefaults"><small>{% trans "Reset to sheet defaults" %}</small></h6>


    </div>


    <div id="publishPromptModal" class="modal s2Modal">
        <div id="prompt">
            <div class="header">
                <span>{% trans "Would you like to make your Source Sheet public?" %}</span>
            </div>

            <p>
            <span>
                {% trans "Your Source Sheet is looking great! You can share it with other members of the Pecha Community by making it public." %}
            </span>
            </p>

            <div class="button publish">
                <span>{% trans "Make Public" %}</span>
            </div>
            <div class="button white later">
                <span>{% trans "Maybe Later" %}</span>
            </div>
        </div>
        <div id="published" style="display:none;">
            <div class="header">
                <span class="{{ language_font_class }}">{% trans "Your Sheet is now Public!" %}</span>
            </div>

            <p>
                <span>{% trans "Thank you for contributing to a free, growing resource for Jewish learning." %}</span>
            </p>

            <div class="button ok">
                <span>{% trans "OK" %}</span>
            </div>
        </div>
        <div id="notPublished" style="display:none;">
            <div class="header">
                <span>{% trans "No problem, this sheet is still not listed on Sefaria." %}</span>
            </div>

            <p>
            <span>
                {% trans "You can make your sheet public in the future from the" %}
                <span class="label">{% trans "Share" %}</span> menu.
            </span>
            </p>

            <div class="button ok">
                <span>{% trans "OK" %}</span>
            </div>
        </div>
    </div>


    {% include "elements/login_prompt.html" with msg="To save, copy, or like, please log in." %}


</div> <!-- end sheetContent -->
{% endblock %}

{% block js  %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
<script>{% include "js/django-csrf.js" %}</script>
<script type="text/javascript" src="{% static 'js/lib/jquery.easing.1.3.js' %}"></script>
<script src="{% static 'js/lib/jquery.tooltipster.min.js' %}"></script>
<script src="{% static 'js/lib/jquery.tag-it.min.js' %}"></script>
<script src="{% static 'js/s1/util.js' %}"></script>

<script type="text/javascript">
{% autoescape off %}
	var sjs = sjs || {};
	$.extend(sjs, {
		current: {{ sheetJSON|default:"null" }},
		assignment_id: {{ assignment_id|default:"null" }},
		assigner_id: {{ assigner_id|default:"null" }},
		can_edit: {% if can_edit %}true{% else %}false{% endif %},
        can_add: {% if can_add %}true{% else %}false{% endif %},
		is_owner: {% if is_owner %}true{% else %}false{% endif %},
		editing: {},
		ref: {},
		loading: 0,
		autosave: false,
		changes: false,
        interfaceLang: "{{ request.interfaceLang }}".substring(0,2),
        interfaceLangLong: "{{ request.interfaceLang }}",
		{% if user.id %}
		_fullname: "{{ user.first_name }} {{ user.last_name }}",
		_userLink: "{{ user.id|user_link }}",
		{% endif %}
	});
{% endautoescape %}


</script>
{% if can_edit or can_add %}
<script>
    var x, i, j, l, ll, selElmnt, a, b, c;
    /*look for any elements with the class "custom-select":*/
    x = document.getElementsByClassName("custom-select");
    l = x.length;
    for (i = 0; i < l; i++) {
      selElmnt = x[i].getElementsByTagName("select")[0];
      ll = selElmnt.length;
      /*for each element, create a new DIV that will act as the selected item:*/
      a = document.createElement("DIV");
      a.setAttribute("class", "select-selected");
      a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
      x[i].appendChild(a);
      /*for each element, create a new DIV that will contain the option list:*/
      b = document.createElement("DIV");
      b.setAttribute("class", "select-items select-hide");
      for (j = 0; j < ll; j++) {
        /*for each option in the original select element,
        create a new DIV that will act as an option item:*/
        c = document.createElement("DIV");
        c.innerHTML = selElmnt.options[j].innerHTML;
        c.addEventListener("click", function(e) {
            /*when an item is clicked, update the original select box,
            and the selected item:*/
            var y, i, k, s, h, sl, yl;
            s = this.parentNode.parentNode.getElementsByTagName("select")[0];
            sl = s.length;
            h = this.parentNode.previousSibling;
            for (i = 0; i < sl; i++) {
              if (s.options[i].innerHTML == this.innerHTML) {
                s.selectedIndex = i;
                h.innerHTML = this.innerHTML;
                y = this.parentNode.getElementsByClassName("same-as-selected");
                yl = y.length;
                for (k = 0; k < yl; k++) {
                  y[k].removeAttribute("class");
                }
                this.setAttribute("class", "same-as-selected");
                break;
              }
            }
            h.click();
        });
        b.appendChild(c);
      }
      x[i].appendChild(b);
      a.addEventListener("click", function(e) {
          /*when the select box is clicked, close any other select boxes,
          and open/close the current select box:*/
          e.stopPropagation();
          closeAllSelect(this);
          this.nextSibling.classList.toggle("select-hide");
          this.classList.toggle("select-arrow-active");
        });
    }
    function closeAllSelect(elmnt) {
      /*a function that will close all select boxes in the document,
      except the current select box:*/
      var x, y, i, xl, yl, arrNo = [];
      x = document.getElementsByClassName("select-items");
      y = document.getElementsByClassName("select-selected");
      xl = x.length;
      yl = y.length;
      for (i = 0; i < yl; i++) {
        if (elmnt == y[i]) {
          arrNo.push(i)
        } else {
          y[i].classList.remove("select-arrow-active");
        }
      }
      for (i = 0; i < xl; i++) {
        if (arrNo.indexOf(i)) {
          x[i].classList.add("select-hide");
        }
      }
    }
    /*if the user clicks anywhere outside the select box,
    then close all select boxes:*/
    document.addEventListener("click", closeAllSelect);
    </script>
    
<script src="{% static 'ckeditor/ckeditor.js' %}"></script>
<script src="{% static 'ckeditor/adapters/jquery.js' %}"></script>
{% endif %}
<script src="{% static 'js/sheets.js' %}"></script>

{% endblock %}
